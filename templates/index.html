<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Yotsuba Channel</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/script.js"></script>
  </head>
  <body>
    <div class="titleBanner">
      <span class="title">Yotsuba Channel よつば☆ちゃんねる</span><br>
      <span class="new">[<a href="javascript:undefined" onclick="openPost()">New Post</a>]</span>
      <div class="postForm" id="postForm">
        <form action="/post/create" method="post">
          <div>
            <label for="newSubject">Subject: </label><br>
            <input type="text" name="newSubject" id="newSubject">
          </div>
          <div>
            <label for="newComment">Comment: </label><br>
            <textarea name="newComment" id="newComment" rows="4" cols="50"></textarea>
          </div>
          <button type="submit">Post</button>
        </form>
      </div>
    </div>
    <hr>
    {% if posts.count() > 0 %}
      {% for post in posts %}
        <div class="post">
          <div>
            <span class="subject">{{post.subject}}</span>
            <span class="name">Anonymous</span>
            <span>{{post.hora.strftime('%Y-%m-%d(%a) %H:%M:%S')}}</span>
            <span>[<a href="javascript:undefined" onclick="openReply('{{post.key.urlsafe()}}')">Reply</a>]</span>
            <div class="replyForm" id="replyForm{{post.key.urlsafe()}}">
              <form action="/reply/create" method="post">
                <div>
                  <label for="newReply">Reply to <span class="name">Anonymus</span></label><br>
                  <textarea name="newReply" id="newReply" rows="4" cols="50"></textarea>
                  <input hidden="hidden" name="post_id" value="{{post.key.urlsafe()}}">
                </div>
                <button type="submit">Reply</button>
              </form>
            </div>
            <blockquote>
              {{post.comment}}
            </blockquote>
          </div>
          {% if post.replies %}
            {% if post.numOfReplies > 5%}
              <span class="post">{{post.numOfReplies - 5}} replies omitted. <a href="/post/show?id={{post.key.urlsafe()}}">Click here</a> to view.</span>
            {% endif %}
            {% for reply in post.replies %}
              <div class="post reply">
                <div>
                  <span class="name">Anonymous</span>
                  <span>{{reply.hora.strftime('%Y-%m-%d(%a) %H:%M:%S')}}</span>
                </div>
                <blockquote>
                  {{reply.comment}}
                </blockquote>
              </div>
            {% endfor %}
          {% endif %}
        </div>
        <hr>
      {% endfor %}
    {% else %}
      <div><span class="post">No posts yet.</span></div>
      <hr>
    {% endif %}
  </body>
</html>